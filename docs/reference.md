<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [indexAvailability][1]
    -   [Parameters][2]
-   [computeAvailability][3]
    -   [Parameters][4]
-   [normalizePolicyDates][5]
    -   [Parameters][6]
-   [createFeeSchedule][7]
    -   [Parameters][8]
-   [reduceFeeSchedule][9]
    -   [Parameters][10]
-   [computeCancellationFees][11]
    -   [Parameters][12]
-   [computeDailyPrice][13]
    -   [Parameters][14]
-   [computeDailyRatePlans][15]
    -   [Parameters][16]
-   [PriceComputerError][17]
-   [PriceComputer][18]
    -   [Parameters][19]
    -   [getBestPriceWithSingleRatePlan][20]
        -   [Parameters][21]
    -   [getPossiblePricesWithSingleRatePlan][22]
        -   [Parameters][23]
    -   [getBestPrice][24]
        -   [Parameters][25]
-   [selectApplicableModifiers][26]
    -   [Parameters][27]
-   [selectBestGuestModifier][28]
    -   [Parameters][29]
-   [selectApplicableRatePlans][30]
    -   [Parameters][31]

## indexAvailability

Transforms raw array of availability records to an
object indexeed by roomTypeId and date.

### Parameters

-   `availability` **[Array][32]** as defined in [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L373][33]

Returns **[Object][34]** such as    {
      "single-bed": {
        "2018-01-01": {
          "quantity": 3,
          "date": "2018-01-01",
          "roomTypeId": "single-bed"
        }
      },
      "double-bed": {
        "2018-01-01": {
          "quantity": 3,
          "date": "2018-01-01",
          "roomTypeId": "single-bed"
        }
      }
    }

## computeAvailability

Aggregates total quantity of available room types during given period.
If data for any day (including arrival and departure) is missing, `undefined`
is returned, otherwise a number is returned.

### Parameters

-   `arrivalDate` **mixed** anything parseable by dayjs
-   `departureDate` **mixed** anything parseable by dayjs
-   `numberOfGuests` **[number][35]** 
-   `roomTypes` **[Array][32]&lt;[Object][34]>** 
-   `indexedAvailability` **[Object][34]** result of `indexAvailability` method

Returns **[Array][32]&lt;[Object][34]>**     [
      { "roomTypeId": "rta", "quantity": 1 },
      { "roomTypeId": "rtb", "quantity": 1 },
      { "roomTypeId": "rtc", "quantity": undefined }
    ]

## normalizePolicyDates

Sorts out real dates for cancellation policies by applying
deadline where possible.

### Parameters

-   `bookingDateDayjs` **dayjs** is used to determine how far in the
    future will the actual stay happen.
-   `arrivalDayjs` **dayjs** is a date of arrival
-   `cancellationPolicies` **[Array][32]&lt;[Object][34]>** List of all declared
    policies

Returns **[Array][32]&lt;[object][34]>** Normalized list of policies where each
record contains from, to, and an appropriate amount.

## createFeeSchedule

Determines the most benefitial cancellation fee for a hotel
for every day between `bookingDateDayjs` and `arrivalDayjs`
(inclusive on both sides).

### Parameters

-   `bookingDateDayjs` **dayjs** is used to determine where to start.
-   `arrivalDayjs` **dayjs** is a date of arrival
-   `normalizedCancellationPolicies` **[Array][32]&lt;[Object][34]>** result of
    `normalizePolicyDates`
-   `defaultCancellationAmount` **[Number][35]** a default that is used
    in case there is no special policy applicable to any given date.

Returns **[Array][32]&lt;[Object][34]>** A list of fees best for a hotel. Items
contain an object containing dateDayjs and amount and are ordered
by date in an ascending order.

## reduceFeeSchedule

Compacts a fee schedule into continuous intervals
with the same amount.

### Parameters

-   `orderedSchedule`  
-   `feeSchedule` **[Array][32]&lt;[Object][34]>** ordered result of createFeeSchedule

Returns **[Array][32]&lt;[Object][34]>** List of periods, each containing from,
to and amount.

## computeCancellationFees

Determines the cancellation fees for any given arrival date
in the future.

### Parameters

-   `bookingDate` **mixed** anything parseable by dayjs marking
    a date on which the booking is happening
-   `arrivalDate` **mixed** anything parseable by dayjs marking
    a date on which the consumer will arrive
-   `cancellationPolicies` **[Array][32]&lt;[Object][34]>** list of policies as defined
    in [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L129][36]
-   `defaultCancellationAmount` **[Number][35]** fallback amount as defined in
    [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L124][37]

Returns **[Array][32]&lt;[Object][34]>** Result of `reduceFeeSchedule`

## computeDailyPrice

Determines a price for all of the guests for a single day
by using the selected rate plan and applying appropriate
modifier for every guest.

### Parameters

-   `guests` **[Array][32]&lt;[Object][34]>** list of information about guests,
    right now only the `age` field is expected
-   `lengthOfStay` **[Number][35]** 
-   `dateDayjs` **dayjs** 
-   `ratePlan` **[Object][34]** 
-   `currentCurrency` **[string][38]** 

Returns **currencyjs** Total amount for all of the guests

## computeDailyRatePlans

Computes all daily prices for all rate plans that
can be applied for every day of the stay and groups
them by currency. If we are not able to cover all days
for any given currency, the whole currency gets dropped.

This allows for flexible rate plan combination strategies
and various end-user price combinations.

This does not allow a combination on a day-guest level, i. e.
a different rate plan can not be picked for different people on the
same day.

### Parameters

-   `arrivalDateDayjs` **dayjs** 
-   `departureDateDayjs` **dayjs** 
-   `guests` **[Array][32]&lt;[Object][34]>** list of information about guests,
    right now only the `age` field is expected
-   `hotelCurrency` **[string][38]** default hotel currency
-   `applicableRatePlans` **[Array][32]&lt;[object][34]>** list of possible rate plans

Returns **[Object][34]** For every currency a record exists in this map. The value
is an array of currencyjs instances that denote the best price
for all guests for a single day.

Returns **[Object][34]** Every key is a currency code and its value is
an array (every index represents a single day). For every day
there is a list of usable daily prices computed from a certain rate plan.    [
      {
        "ratePlan": <RatePlan object>,
        "dailyPrice": <Result of computeDailyPrice>
      }
    ]

## PriceComputerError

**Extends Error**

Error scoped to PriceComputer

## PriceComputer

A class for computing prices. It contains
multiple price resolution strategies for
hotels.

### Parameters

-   `roomTypes` **[Array][32]&lt;[Object][34]>** List of room types as defined
    in [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L136][39]
-   `ratePlans` **[Array][32]&lt;[Object][34]>** List of rate plans as defined in
    [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L212][40]
-   `defaultCurrency` **[string][38]** currency used when a rate plan has
    no currency specified

### getBestPriceWithSingleRatePlan

Returns the rate plan that covers the whole stay
with the best price.

#### Parameters

-   `bookingDate` **mixed** 
-   `arrivalDate` **mixed** 
-   `departureDate` **mixed** 
-   `guests` **[Array][32]&lt;[Object][34]>** list of information about guests,
    right now only the `age` field is expected
-   `currency` **[string][38]** optional filter by currency
-   `roomTypeId` **[string][38]** optional filter by roomTypeId

Returns **[Array][32]&lt;[Object][34]>** List of roomTypes and their prices    [
      {
        "id": "RoomTypeId",
        "prices": [
          {
            "currency": "CZK",
            "total": <currencyjs instance>,
            "ratePlan": <RatePlan object>
          }
        ]
      }
    ]

### getPossiblePricesWithSingleRatePlan

Returns all of the rate plans that cover the whole stay.
A client can choose the most fitting one for their purpose.

#### Parameters

-   `bookingDate` **mixed** 
-   `arrivalDate` **mixed** 
-   `departureDate` **mixed** 
-   `guests` **[Array][32]&lt;[Object][34]>** list of information about guests,
    right now only the `age` field is expected
-   `currency` **[string][38]** optional filter by currency
-   `roomTypeId` **[string][38]** optional filter by roomTypeId

Returns **[Array][32]&lt;[Object][34]>** List of roomTypes and their prices    [
      {
        "id": "RoomTypeId",
        "prices": [
          {
            "currency": "CZK",
            "ratePlans": [
              {
                "ratePlan": <RatePlan object>,
                "dailyPrices": [
                  <Result of computeDailyPrice>,
                  <Result of computeDailyPrice>,
                  ...
                ],
                "total": <currencyjs object>
              }
            ]
          }
        ]
      }
    ]

### getBestPrice

Computes the best prices for given period of time and
a party of guests. This picks the best rate plan
for every guest for every single day.

If no currency or roomTypeId is specified, all variants
are computed.

To report
a price, a combination of rate plans in every currency
has to cover the whole period between `arrivalDateDayjs`
and `departureDateDayjs`.

#### Parameters

-   `bookingDate` **mixed** anything parseable by dayjs
-   `arrivalDate` **mixed** anything parseable by dayjs
-   `departureDate` **mixed** anything parseable by dayjs
-   `guests` **[Array][32]&lt;[Object][34]>** List of information about guests
-   `currency` **[string][38]** you can limit the results only
    to this currency
-   `roomTypeId` **[string][38]** you can limit the results only to
    this roomTypeId

Returns **[Array][32]** List of prices for every room type. Every item in
the array contains an id (roomTypeId) and a list of `prices` for all
applicable currencies such as this. The total sum is an instance
of currencyjs. In case of no applicable rate plans, the prices array
is empty.    [
      {
        "id": "single-bed",
        "prices": [
          {
            "currency": "EUR",
            "total": 123.12
          },
          {
            "currency": "USD",
            "total": 130
          }
        ]
      }
    ]

## selectApplicableModifiers

Picks rate plans modifiers applicable under given conditions.

### Parameters

-   `modifiers` **[Array][32]&lt;[Object][34]>** List of rate plan modifiers as
    defined in [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L296][41]
-   `dateDayjs` **dayjs** A date for which we want to apply modifiers
-   `lengthOfStay` **[Number][35]** 
-   `numberOfGuests` **[Number][35]** 

Returns **[Array][32]&lt;[Object][34]>** List of modifiers that can be applied

## selectBestGuestModifier

Selects a modifier that is most in favour of a guest
with given age. If no age based modifier is applicable,
the best one from non-specific modifiers is used.

### Parameters

-   `modifiers` **[Array][32]&lt;[Object][34]>** List of rate plan modifiers as
    defined in [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L296][41]
-   `age` **[Number][35]** Guest's age

Returns **[Object][34]** The modifier with the best rate in
favour of a guest.

## selectApplicableRatePlans

Filters out rate plans that cannot be used under
given conditions.

### Parameters

-   `roomTypeId` **[string][38]** 
-   `ratePlans` **[Array][32]&lt;[Object][34]>** list of rate plans as defined in
    [https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L212][40]
-   `bookingDateDayjs` **dayjs** 
-   `arrivalDateDayjs` **dayjs** 
-   `departureDateDayjs` **dayjs** 
-   `fallbackCurrency` **[string][38]** used when rate plans does not have
    a currency defined
-   `preferredCurrency` **([string][38] | null | [undefined][42])** You can limit the results to
    this single currency for faster processing (optional, default `null`)

Returns **[Array][32]&lt;[Object][34]>** List of usable rate plans.

[1]: #indexavailability

[2]: #parameters

[3]: #computeavailability

[4]: #parameters-1

[5]: #normalizepolicydates

[6]: #parameters-2

[7]: #createfeeschedule

[8]: #parameters-3

[9]: #reducefeeschedule

[10]: #parameters-4

[11]: #computecancellationfees

[12]: #parameters-5

[13]: #computedailyprice

[14]: #parameters-6

[15]: #computedailyrateplans

[16]: #parameters-7

[17]: #pricecomputererror

[18]: #pricecomputer

[19]: #parameters-8

[20]: #getbestpricewithsinglerateplan

[21]: #parameters-9

[22]: #getpossiblepriceswithsinglerateplan

[23]: #parameters-10

[24]: #getbestprice

[25]: #parameters-11

[26]: #selectapplicablemodifiers

[27]: #parameters-12

[28]: #selectbestguestmodifier

[29]: #parameters-13

[30]: #selectapplicablerateplans

[31]: #parameters-14

[32]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[33]: https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L373

[34]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[35]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[36]: https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L129

[37]: https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L124

[38]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[39]: https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L136

[40]: https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L212

[41]: https://github.com/windingtree/wiki/blob/d64397e5fb6e439f8436ed856f60664d08ae9b48/hotel-data-swagger.yaml#L296

[42]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined
